
<!-- saved from url=(0045)http://ifoodmm.com/html/201707/201707025.html -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-CN"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        
        <title>基于OpenCV的食品包装缺陷分割方法</title>
    </head>
    <body style="font-family:SimSun;word-break:normal;word-wrap:break-word;">
        <h1 style="color:#c36500;font-size:2.0em;font-weight:bold;margin:1em;text-align:center;">基于OpenCV的食品包装缺陷分割方法</h1>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:center;">杨 洋</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:center;">项辉宇</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:center;">冷崇杰</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:center;">薛 真</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:center;">(北京工商大学材料与机械工程学院，北京 100048)</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:0em;text-justify:inter-ideograph;"><b>摘要：</b>针对现有食品包装表面印刷缺陷分割算法中分割速度慢、精度低的问题，提出基于OpenCV实现图像差分与形态学处理结合的表面缺陷分割方法。分别对模版图像和待测图像进行高斯低通滤波运算；将预处理后的两幅图像作差分运算，得到其差分结果；采用形态学开运算来去除差分图像的噪声并标出目标缺陷位置。选取污点、飞墨、漏印3类缺陷样本各30组进行试验，结果表明：该法能够达到的平均准确率为91.51%，93.41%，94.14%，平均的分割时间仅为 46.6 ms。</p>
        <p style="padding-bottom:2%;font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:0em;text-justify:inter-ideograph;"><b>关键词：</b>食品包装；视觉检测；图像分割；OpenCV</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;">对食品包装行业来说，其包装外观印刷中的漏印、飞墨、污点等缺陷，直接影响消费者对该商品的第一印象。随着现代商品包装工业的发展，人们对商品包装的外观设计要求越来越高。特别是随着商品市场的繁荣，人们更多地依赖于商品的外观来评价商品的档次。因此，在包装出厂的检测阶段，对外观缺陷的发现与剔除就显得尤为重要。包装外观缺陷检测的关键是准确且迅速地对包装表面图像进行分割，在此分割的基础上对目标缺陷进行采集与分析，从而提升包装印刷缺陷产品在线剔除的自动化水平。缺陷分割是指将感兴趣的缺陷目标从捕获的众多图像背景信息(如轮廓、颜色、形状、亮度)中分离出来，使缺陷成为分析和处理对象的过程，是视觉检测的关键。</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;">目前，图像分割算法主要有：阈值分割法<span tag="1" style="font-size:0.6em;vertical-align:super;">[1]</span>、基于区域的分割算法<span tag="2" style="font-size:0.6em;vertical-align:super;">[2]</span>以及混合分割算法<span tag="3" style="font-size:0.6em;vertical-align:super;">[3]</span>。阈值分割算法因其实现简单、性能稳定等特点曾获得广泛应用，然而在对像素间关系的区分方面又显出一些劣势，往往容易使不同的分割区域产生混淆<span tag="4" style="font-size:0.6em;vertical-align:super;">[4]</span>。由于噪声和灰度分布的不均匀，基于区域的分割算法容易产生过分割<span tag="5" style="font-size:0.6em;vertical-align:super;">[5]</span>。混合分割算法则多是融合某几种理论组合而来，这类方法往往有运算量大，结构复杂的特点。此外，贺振东等<span tag="6" style="font-size:0.6em;vertical-align:super;">[6]</span>利用背景差分法实现了高铁钢轨表面缺陷图像的分割，解决了铁轨表面缺陷分割过程中图像光照变化、反射不均、特征少等不利因素的影响。胡敏等<span tag="7" style="font-size:0.6em;vertical-align:super;">[7]</span>采用形态学标记的方法，对标记后的梯度图像进行分水岭算法的图像分割，该方法有效地解决了缺陷轮廓过分割的问题。杨慧斌等<span tag="8" style="font-size:0.6em;vertical-align:super;">[8]</span>利用OCR识别技术实现了针对印刷字符错码和漏码的分割检测。</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;">为实现包装印刷中的缺陷分割，本研究提出基于OpenCV采用背景图像差分和形态学处理结合的方法。对模版图像和待测图像进行采集和预处理，求取二者之间的差分结果并进行二值化处理，利用形态学处理的方法对差分图像开运算去除噪声获得目标缺陷。旨在提出一种解决缺陷分割过程中分割速度慢、精度低的问题的方法。</p>
        <h2 style="color:#c36500;font-size:1.4em;font-weight:bold;margin:0.7em;text-align:left;text-indent:0em;">1 原理</h2>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;">通过图像采集系统，获取模版图像和待测图像，针对两幅图像通过运用高斯滤波器实现初步图像降噪的预处理<span tag="9" style="font-size:0.6em;vertical-align:super;">[9]</span>。将待测图像与模版图像差分，获得差分结果。运用形态学开运算达到去噪的精细处理，提取出缺陷分割结果。整体流程见图1。</p>
        <div style="text-align:center;vertical-align:middle;"><img id="eae2c6764b8caeda10791e9f4509688a" src="./基于OpenCV的食品包装缺陷分割方法_files/c1afc9b96e2090e13252fadb2a7c27ff.jpg" width="229" height="217" style="text-align:center;vertical-align:middle;"><p style="font-size:0.8em;line-height:1.8em;margin-top:0.2em;text-align:center;">图1 整体流程</p><p style="font-size:0.8em;line-height:1.8em;margin-top:0.2em;text-align:center;">Figure 1 The overall process</p></div>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;">1.1 高斯滤波</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;">高斯滤波一般有2种实现方式：用离散化窗口滑窗卷积和通过傅里叶变换<span tag="10" style="font-size:0.6em;vertical-align:super;">[10]</span>。考虑到滑窗计算量大的问题，选用基于傅里叶变换的实现方法<span tag="11" style="font-size:0.6em;vertical-align:super;">[11]137-166</span>。用<span style="font-style:italic;">f</span>(<span style="font-style:italic;">x</span>,<span style="font-style:italic;">y</span>)表示一幅<span style="font-style:italic;">M</span>×<span style="font-style:italic;">N</span>的标准图像，其二维傅里叶变换公式为：</p>
        <div style="text-align:center;vertical-align:middle;"><img id="5b3f7328b97b086838ec1836b8d76a0b" src="./基于OpenCV的食品包装缺陷分割方法_files/ad47eabb16bac18c07bdb20db6935f29.jpg" width="284" height="38" style="text-align:center;vertical-align:middle;"></div>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:right;text-indent:2.0em;">(1)</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;">式中：</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;"><span style="font-style:italic;">f</span>(<span style="font-style:italic;">x</span>,<span style="font-style:italic;">y</span>)——空间域图像的灰度值表示，像素；</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;"><span style="font-style:italic;">M</span>,<span style="font-style:italic;">N</span>——图像的像素坐标，像素；</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;"><span style="font-style:italic;">F</span>(<span style="font-style:italic;">u</span>,<span style="font-style:italic;">v</span>)——频率域图像的幅值与相位角(其中，实部表示图像的幅值，像素；虚部表示图像的相位角，弧度)；</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;"><span style="font-style:italic;">u</span>——图像在频率域的横坐标(<span style="font-style:italic;">u</span>=0,1,2,…,<span style="font-style:italic;">M</span>-1)，像素；</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;"><span style="font-style:italic;">v</span>——图像在频率域的纵坐标(<span style="font-style:italic;">v</span>=0,1,2,…,<span style="font-style:italic;">N</span>-1)，像素。</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;">傅里叶逆变换公式为：</p>
        <div style="text-align:center;vertical-align:middle;"><img id="50bb7ad12f57160f38623691be5da9e0" src="./基于OpenCV的食品包装缺陷分割方法_files/b24a9691d9467578fbe71b22d53ed472.jpg" width="248" height="38" style="text-align:center;vertical-align:middle;"></div>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:right;text-indent:2.0em;">(2)</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;">高斯低通滤波器的传递函数为：</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;"><span style="font-style:italic;">H</span>(<span style="font-style:italic;">u</span>,<span style="font-style:italic;">v</span>)=<span style="font-style:italic;">e</span><span style="font-size:0.6em;vertical-align:super;">-<span style="font-style:italic;">D</span><span style="font-size:0.6em;vertical-align:super;">2</span>(<span style="font-style:italic;">u</span>,<span style="font-style:italic;">v</span>)/2<span style="font-style:italic;">σ</span><span style="font-size:0.6em;vertical-align:super;">2</span></span>，</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:right;text-indent:2.0em;">(3)</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;">式中：</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;"><span style="font-style:italic;">D</span>(<span style="font-style:italic;">u</span>,<span style="font-style:italic;">v</span>)——距傅里叶变换原点的距离，像素；</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;"><span style="font-style:italic;">σ</span>——标准偏差(表示高斯曲线扩展的程度)。</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;">设置截止频率<span style="font-style:italic;">D</span><span style="font-size:0.6em;vertical-align:sub;">0</span>，当σ=<span style="font-style:italic;">D</span><span style="font-size:0.6em;vertical-align:sub;">0</span>时，可知<img id="3a66786f5ed88c8e702d7b85d93f5b0d" src="./基于OpenCV的食品包装缺陷分割方法_files/12fcd96108b2bf6f643597a45f02d8e5.jpg" width="146" height="17" style="vertical-align:middle;">则经过高斯滤波后的图像为：</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;"><span style="font-style:italic;">f</span><span style="font-size:0.6em;vertical-align:sub;"><span style="font-style:italic;">g</span></span>(<span style="font-style:italic;">x</span>,<span style="font-style:italic;">y</span>)=<img id="f49455d1c7559440acdcc8d886c58508" src="./基于OpenCV的食品包装缺陷分割方法_files/e55bc35e92644eac0d84165e8c7d6c31.jpg" width="29" height="26" style="vertical-align:middle;"><img id="777c122e1ed5d9e178cdd09ff282941a" src="./基于OpenCV的食品包装缺陷分割方法_files/70376d63dc606fb2ce6940cd3292a989.jpg" width="44" height="38" style="vertical-align:middle;"><span style="font-style:italic;">F</span>(<span style="font-style:italic;">u</span>,<span style="font-style:italic;">v</span>)<span style="font-style:italic;">H</span>(<span style="font-style:italic;">u</span>,<span style="font-style:italic;">v</span>)<span style="font-style:italic;">e</span><span style="font-size:0.6em;vertical-align:super;"><span style="font-style:italic;">j</span>2π(<span style="font-style:italic;">ux</span>/<span style="font-style:italic;">M</span>+<span style="font-style:italic;">vy</span>/<span style="font-style:italic;">N</span>)</span>。</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:right;text-indent:2.0em;">(4)</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;">1.2 图像差分</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;">图像差分是一种图像的代数运算，即通过计算两幅图像所对应像素点的差来表现出两幅图像的差异<span tag="12" style="font-size:0.6em;vertical-align:super;">[12]</span>。由于该方法原理简单，计算效率高，因而其在图像分割上有非常广泛的应用，尤其是对于在线检测等实时性强的图像处理过程，更是有良好的检测效果。</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;">如果用<span style="font-style:italic;">f</span>(<span style="font-style:italic;">x</span>,<span style="font-style:italic;">y</span>)表示模版图像，<span style="font-style:italic;">g</span>(<span style="font-style:italic;">x</span>,<span style="font-style:italic;">y</span>)表示待测图像。两个图像的差分运算存在3种情况，即正差、负差和绝对值差。<span style="font-style:italic;">h</span><span style="font-size:0.6em;vertical-align:sub;">1</span>(<span style="font-style:italic;">x</span>,<span style="font-style:italic;">y</span>)，<span style="font-style:italic;">h</span><span style="font-size:0.6em;vertical-align:sub;">2</span>(<span style="font-style:italic;">x</span>,<span style="font-style:italic;">y</span>)，<span style="font-style:italic;">h</span><span style="font-size:0.6em;vertical-align:sub;">3</span>(<span style="font-style:italic;">x</span>,<span style="font-style:italic;">y</span>)分别是3种情况时对应的结果图像<span tag="13" style="font-size:0.6em;vertical-align:super;">[13]</span>。</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;">(1) 正差用模版图像减去待测图像表示：</p>
        <div style="text-align:center;vertical-align:middle;"><img id="da8a3f6442869570a1aecf1577d124d6" src="./基于OpenCV的食品包装缺陷分割方法_files/27f3b37ac7e5ec5b5d19373e94717663.jpg" width="313" height="38" style="text-align:center;vertical-align:middle;"></div>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:right;text-indent:2.0em;">(5)</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;">当<span style="font-style:italic;">f</span>(<span style="font-style:italic;">x</span>,<span style="font-style:italic;">y</span>)&lt;<span style="font-style:italic;">g</span>(<span style="font-style:italic;">x</span>,<span style="font-style:italic;">y</span>) 时，由于像素点处取值非负，则结果归零处理。此时，这些像素间的差异信息缺失。</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;">(2) 负差用待测图像减去模版图像表示：</p>
        <div style="text-align:center;vertical-align:middle;"><img id="a97081eb8ceccb9908bc9e4a0098e4c1" src="./基于OpenCV的食品包装缺陷分割方法_files/79ce9c3a1735c2d2ee68ba66a6778835.jpg" width="313" height="38" style="text-align:center;vertical-align:middle;"></div>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:right;text-indent:2.0em;">(6)</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;">同理，当<span style="font-style:italic;">f</span>(<span style="font-style:italic;">x</span>,<span style="font-style:italic;">y</span>)&gt;<span style="font-style:italic;">g</span>(<span style="font-style:italic;">x</span>,<span style="font-style:italic;">y</span>)时，其结果也做归零处理。此时，这些像素间的差异信息也将缺失。</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;">(3) 绝对差的计算方法是采用模板图像和待检测图像求取绝对差，能够有效弥补正差和负差产生的部分差异信息丢失的问题，其表示见式(7)。</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;"><span style="font-style:italic;">h</span><span style="font-size:0.6em;vertical-align:sub;">3</span>(<span style="font-style:italic;">x</span>,<span style="font-style:italic;">y</span>)=|<span style="font-style:italic;">f</span>(<span style="font-style:italic;">x</span>,<span style="font-style:italic;">y</span>)-<span style="font-style:italic;">g</span>(<span style="font-style:italic;">x</span>,<span style="font-style:italic;">y</span>)|。</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:right;text-indent:2.0em;">(7)</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;">1.3 形态学处理</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;">受图像表面特征的影响，差分图像的结果中有时会存在一些随机出现的区域噪声。而通过形态学开运算的处理，能够将这些噪声有效过滤，使正确的缺陷轮廓得以保留<span tag="11" style="font-size:0.6em;vertical-align:super;">[11]420-454</span>。膨胀和腐蚀是形态学中的2种基础操作，开运算是经过先腐蚀后膨胀的组合过程来实现的。对于差分图像<span style="font-style:italic;">h</span><span style="font-size:0.6em;vertical-align:sub;">3</span>(<span style="font-style:italic;">x</span>,<span style="font-style:italic;">y</span>)，其开运算的处理过程可表示为：</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;"><span style="font-style:italic;">h</span><span style="font-size:0.6em;vertical-align:sub;">3</span>(<span style="font-style:italic;">x</span>,<span style="font-style:italic;">y</span>)°<span style="font-style:italic;">E</span>=[<span style="font-style:italic;">h</span><span style="font-size:0.6em;vertical-align:sub;">3</span>(<span style="font-style:italic;">x</span>,<span style="font-style:italic;">y</span>)Θ<span style="font-style:italic;">E</span>]⊕<span style="font-style:italic;">E</span>。</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:right;text-indent:2.0em;">(8)</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;">其中<span style="font-style:italic;">E</span>为3×3的矩形结构元素。</p>
        <h2 style="color:#c36500;font-size:1.4em;font-weight:bold;margin:0.7em;text-align:left;text-indent:0em;">2 试验</h2>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;">2.1 试验步骤</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;">本试验硬件环境为:Intel酷睿Q9500，主频2.83 GHz的CPU，4 GB内存的PC机。检测用工业摄像头型号为维视MV-1300UC。软件环境为Win7操作系统下VisualStudio2010与OpenCV2.4.8共同搭建的算法实现平台。</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;">缺陷图像的分割过程(见图2)：① 在试验平台上采集模版图像和待测图像，通过高斯滤波进行初步降噪的预处理；② 对经过处理的两幅图像进行差分运算得到其差分结果，此时的差分图像上会含有一些随机产生的噪点；③ 运用形态学开运算对二值化的差分图像进行去噪声处理，最终提取出缺陷目标的分割结果。其中，各步骤中的运算耗时见表1。</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;">2.2 结果分析</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;">运用本方法，以包装印刷中的污点、飞墨、漏印3类缺陷样本各30组进行分割试验，图3(a)～(c)为待测缺陷样本，图3(d)～(f)为对应的分割提取结果。经过统计所有90个样本的分割时间，计算出平均耗时为46.6 ms。</p>
        <div style="text-align:center;vertical-align:middle;"><img id="20b3277233c680ef6c77b5c5e36a508a" src="./基于OpenCV的食品包装缺陷分割方法_files/514bf8f31d88a846131e37c357a756c6.jpg" width="348" height="222" style="text-align:center;vertical-align:middle;"><p style="font-size:0.8em;line-height:1.8em;margin-top:0.2em;text-align:center;">图2 缺陷分割过程</p><p style="font-size:0.8em;line-height:1.8em;margin-top:0.2em;text-align:center;">Figure 2 The process of defect segmentation</p><p style="font-size:0.8em;line-height:1.8em;margin-top:0.2em;text-align:center;"><span style="font-weight:bold;">表</span>1<span style="font-weight:bold;">各步运算所用时间</span></p><p style="font-size:0.8em;line-height:1.8em;margin-top:0.2em;text-align:center;">Table 1 The time taken for each step</p></div>
        <div style="text-align:center;vertical-align:middle;"><img id="a9cde37c6903cadb163778422d567d3a" src="./基于OpenCV的食品包装缺陷分割方法_files/3c3f03d32eb0e957dd328c6cc86fd34e.jpg" width="264" height="134" style="text-align:center;vertical-align:middle;"><p style="color:red;display:none;font-size:0.8em;line-height:1.8em;text-align:left;">计算步骤计算时间/ms高斯滤波 15.5图像差分 2.6差分结果二值化3.2形态学开运算 22.4总计 43.7</p></div>
        <div style="text-align:center;vertical-align:middle;"><img id="ccbdd356b07ab37fef783608e918172a" src="./基于OpenCV的食品包装缺陷分割方法_files/74041ff632355ccb7a3cd10290b4204e.jpg" width="346" height="221" style="text-align:center;vertical-align:middle;"><p style="font-size:0.8em;line-height:1.8em;margin-top:0.2em;text-align:center;">图3 样本分割结果</p><p style="font-size:0.8em;line-height:1.8em;margin-top:0.2em;text-align:center;">Figure 3 The results of sample segmentation</p></div>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;">为评估图像分割方法的实际效果，引入了灰色聚类决策理论，并依据此理论建立了决策模型<span tag="14" style="font-size:0.6em;vertical-align:super;">[14]</span>。对于所选3类缺陷样本的分割结果，利用该模型进行评价分析，提取出正确面积因子、错误面积因子和形状因子作为参考因素。</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;">正确面积因子：</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;"><span style="font-style:italic;">m</span><span style="font-size:0.6em;vertical-align:sub;"><span style="font-style:italic;">r</span></span>=<span style="font-style:italic;">T</span><span style="font-size:0.6em;vertical-align:sub;"><span style="font-style:italic;">r</span></span>/<span style="font-style:italic;">T</span>，</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:right;text-indent:2.0em;">(9)</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;">式中：</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;"><span style="font-style:italic;">m</span><span style="font-size:0.6em;vertical-align:sub;"><span style="font-style:italic;">r</span></span>——正确面积因子(属于越大越优型)；</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;"><span style="font-style:italic;">T</span>——目标的实际面积，像素；</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;"><span style="font-style:italic;">T</span><span style="font-size:0.6em;vertical-align:sub;"><span style="font-style:italic;">r</span></span>——目标正确分割部分的面积，像素。</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;">错误面积因子：</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;"><span style="font-style:italic;">m</span><span style="font-size:0.6em;vertical-align:sub;"><span style="font-style:italic;">w</span></span>=<span style="font-style:italic;">T</span><span style="font-size:0.6em;vertical-align:sub;"><span style="font-style:italic;">w</span></span>/<span style="font-style:italic;">T</span>，</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:right;text-indent:2.0em;">(10)</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;">式中：</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;"><span style="font-style:italic;">m</span><span style="font-size:0.6em;vertical-align:sub;"><span style="font-style:italic;">w</span></span>——错误面积因子(属于越小越优型)；</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;"><span style="font-style:italic;">T</span><span style="font-size:0.6em;vertical-align:sub;"><span style="font-style:italic;">w</span></span>——错误分割的面积，像素。</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;">形状因子：</p>
        <div style="text-align:center;vertical-align:middle;"><img id="80d521dc709cea0937cf57d0d8ef84f7" src="./基于OpenCV的食品包装缺陷分割方法_files/610520c221f9ec18bff45dc6f673beca.jpg" width="316" height="23" style="text-align:center;vertical-align:middle;"></div>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:right;text-indent:2.0em;">(11)</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;">式中：</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;"><span style="font-style:italic;">m</span><span style="font-size:0.6em;vertical-align:sub;"><span style="font-style:italic;">f</span></span>——形状因子；</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;"><span style="font-style:italic;">l</span><span style="font-size:0.6em;vertical-align:sub;"><span style="font-style:italic;">T</span></span>——标准缺陷周长，像素；</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;"><span style="font-style:italic;">l</span><span style="font-size:0.6em;vertical-align:sub;"><span style="font-style:italic;">r</span></span>——分割缺陷周长，像素。</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;">将图像中的影响因子组成向量<span style="font-style:italic;"><span style="font-weight:bold;">X</span></span>，图像的分割精度定义为，<span style="font-style:italic;">Ρ</span>=∑<span style="font-style:italic;">W</span><span style="font-size:0.6em;vertical-align:sub;"><span style="font-style:italic;">i</span></span>·<span style="font-style:italic;">X</span><span style="font-size:0.6em;vertical-align:sub;"><span style="font-style:italic;">i</span></span>，其中<span style="font-style:italic;">W</span><span style="font-size:0.6em;vertical-align:sub;"><span style="font-style:italic;">i</span></span>表示第<span style="font-style:italic;">i</span>个影响因子的权值，∑<span style="font-style:italic;">W</span><span style="font-size:0.6em;vertical-align:sub;"><span style="font-style:italic;">i</span></span>=1。缺损情况下，<span style="font-style:italic;">W</span>=[1/3，1/3，1/3]；当缺陷区域出现过分割时，定义<span style="font-style:italic;">W</span>=[1/5，3/5，1/5]。分割结果越准确，其分割精度越接近100%。表2列出了部分样本分割精度的结果。由表2可知，不同权值的设置能够有效抑制过分割的影响，提升分割精度。</p>
        <div style="text-align:center;vertical-align:middle;"><p style="font-size:0.8em;line-height:1.8em;margin-bottom:0.2em;text-align:center;"><span style="font-weight:bold;">表</span>2<span style="font-weight:bold;">部分样本的分割精度</span></p><p style="font-size:0.8em;line-height:1.8em;margin-bottom:0.2em;text-align:center;">Table 2 Segmentation accuracy of some samples</p><img id="5a1ae63a0ef6520a3b95acaee3dd22be" src="./基于OpenCV的食品包装缺陷分割方法_files/59b29e038bc077118c5c5d17703d800f.jpg" width="316" height="264" style="text-align:center;vertical-align:middle;"><p style="color:red;display:none;font-size:0.8em;line-height:1.8em;text-align:left;">样本序号污点飞墨漏印194.2696.4594.21293.5293.2593.26390.6594.1695.66496.2796.7595.22591.8393.2195.56693.4791.2794.51789.2390.6294.85886.2196.4589.53988.3891.2196.361091.2890.7692.25平均值91.5193.4194.14</p></div>
        <h2 style="color:#c36500;font-size:1.4em;font-weight:bold;margin:0.7em;text-align:left;text-indent:0em;">3 结论</h2>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;">实时检测与分割出包装印刷中的缺陷，是流水线检测中的关键环节。通过快速准确的缺陷分割，能够有效定位缺陷区域，并剔除缺陷产品。本研究采用图像差分算法对模版图像和待测图像进行绝对差分计算，得到差分结果；结合形态学开运算处理去除差分结果中的随机区域噪声，同时通过OpenCV平台验证了本方法的可行性。试验中，使用该方法对三类主要缺陷各30组样本进行缺陷分割，结果表明，三类缺陷分割的平均准确率分别达到91.51%，93.41%，94.14%，平均的运算时间为46.6 ms。本研究方法分割精度和时间均能满足实时性在线检测的要求。</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:0em;text-justify:inter-ideograph;"><b>参考文献</b></p>
        <p name="ref1" style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;">[1] 龙建武, 申铉京, 陈海鹏. 自适应最小误差阈值分割算法[J]. 自动化学报, 2012, 38(7): 1 134-1 144.</p>
        <p name="ref2" style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;">[2] 徐少平, 刘小平, 李春泉, 等. 基于区域最大相似度的快速图像分割算法[J]. 光电子·激光, 2013(5): 990-998.</p>
        <p name="ref3" style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;">[3] 卢夏衍, 李昕, 冉鹏, 等. 温室幼苗图像的多算法融合区域生长分割算法研究[J]. 中国农机化学报, 2016, 37(6): 89-93.</p>
        <p name="ref4" style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;">[4] KANG Chung-chia, WANG Wen-June, KANG Chung-hao. Image segmentation with complicated background by using seeded region growing[J]. AEU-International Journal of Electronics and Communications, 2012, 66(9): 767-771.</p>
        <p name="ref5" style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;">[5] 曹军, 许雷, 张怡卓, 等. 实木地板图像差分和形态学分割算法研究[J]. 安徽农业科学, 2013(28): 11 403-11 406.</p>
        <p name="ref6" style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;">[6] 贺振东, 王耀南, 刘洁, 等. 基于背景差分的高铁钢轨表面缺陷图像分割[J]. 仪器仪表学报, 2016, 37(3): 640-649.</p>
        <p name="ref7" style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;">[7] 胡敏, 蔡慧芬. 基于形态学标记连通的分水岭图像分割[J]. 电子测量与仪器学报, 2011, 25(10): 864-869.</p>
        <p name="ref8" style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;">[8] 杨慧斌, 闫娟. 基于LabVIEW的食品包装喷码视觉检测方法[J]. 食品与机械, 2016, 32(4): 123-126.</p>
        <p name="ref9" style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;">[9] 何小虎. 基于计算机视觉的啤酒瓶空瓶检测图像采集技术[J]. 食品与机械, 2016, 32(5): 105-107.</p>
        <p name="ref10" style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;">[10] 姒绍辉, 胡伏原, 顾亚军, 等. 一种基于不规则区域的高斯滤波去噪算法[J]. 计算机科学, 2014(11): 313-316.</p>
        <p name="ref11" style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;">[11] RAFAEL C Gonzalez, RICHARD E Woods. 数字图像处理[M]. 2版. 阮秋琦, 阮宇智, 译. 北京: 电子工业出版社, 2007.</p>
        <p name="ref12" style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;">[12] 杨单. 基于图像差分特征的彩色图像差分预测与信息提取算法研究[J]. 计算机科学, 2015(1): 308-311.</p>
        <p name="ref13" style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;">[13] 彭向前. 产品表面缺陷在线检测方法研究及系统实现[D]. 武汉: 华中科技大学, 2008: 45-48.</p>
        <p name="ref14" style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:2.0em;text-justify:inter-ideograph;">[14] 吴志川, 彭国华. 基于灰色聚类决策的图像分割性能评价[J]. 计算机工程与应用, 2012, 48(19): 197-200.</p>
        <h1 style="color:#c36500;font-size:2.0em;font-weight:bold;margin:1em;text-align:center;">Food packaging defect segmentation based OpenCV method</h1>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:center;"><span style="font-style:italic;">YANG</span><span style="font-style:italic;">Yang</span></p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:center;"><span style="font-style:italic;">XIANG</span><span style="font-style:italic;">Hui</span>-<span style="font-style:italic;">yu</span></p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:center;"><span style="font-style:italic;">LENG</span><span style="font-style:italic;">Chong</span>-<span style="font-style:italic;">jie</span></p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:center;"><span style="font-style:italic;">XUE</span><span style="font-style:italic;">Zhen</span></p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:center;">(<span style="font-style:italic;">College</span><span style="font-style:italic;">of</span><span style="font-style:italic;">Material</span><span style="font-style:italic;">Science</span><span style="font-style:italic;">and</span><span style="font-style:italic;">Mechanical</span><span style="font-style:italic;">Engineering</span>,<span style="font-style:italic;">Beijing</span><span style="font-style:italic;">Technology</span><span style="font-style:italic;">and</span><span style="font-style:italic;">Business</span><span style="font-style:italic;">University</span>,<span style="font-style:italic;">Beijing</span>100048,<span style="font-style:italic;">China</span>)</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:0em;text-justify:inter-ideograph;"><b>Abstract：</b>Assembly line detection more depend on the machine vision technology, and image segmentation is the key step in the detection. To solve the problem of slow speed and low accuracy of defects segmentation methods to the surface defects of food packing, proposed a segmenting method based on image difference and mathematical morphology in OpenCV. Firstly, compute the template image of the target image and filter them by a low pass filter. Secondly, differential operation is happened on the two pretreated images to obtain the differential image. Finally, using morphological opening operation to remove the noise on the difference image and get the position of defects image. In this paper, 30 groups of defect samples, such as stain, misting and stripping, were selected and the experimental results were recorded. The results showed that the average accuracies of the proposed method were 91.51%, 93.41%, 94.14%, respectively, and the average segmentation time was only 46.6 ms.</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:0em;text-justify:inter-ideograph;"><b>Keywords：</b>food packaging; visual inspection; image segmentation; OpenCV</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:0em;text-justify:inter-ideograph;"><b>作者简介：</b>杨洋，男，北京工商大学在读硕士研究生。</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:0em;text-justify:inter-ideograph;"><b>通信作者：</b>项辉宇(1966—)，男，北京工商大学教授，博士。 Email：xianghy@th.btbu.edu.cn</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:0em;text-justify:inter-ideograph;"><b>收稿日期：</b>2017—02—05</p>
        <p style="font-size:1.0em;line-height:1.8em;margin:0.5em;text-align:justify;text-indent:0em;text-justify:inter-ideograph;"><b>DOI：</b><span style="font-weight:bold;">10</span>.<span style="font-weight:bold;">13652</span>/<span style="font-weight:bold;">j</span>.<span style="font-weight:bold;">issn</span>.<span style="font-weight:bold;">1003-5788</span>.<span style="font-weight:bold;">2017</span>.<span style="font-weight:bold;">07</span>.<span style="font-weight:bold;">024</span></p>
        	<script type="text/javascript">
	    	var css={
	    		cssBox:'position: fixed; left: 0; top: 0; width: 98%; height: 98%; padding: 1%; background: rgba(0,0,0,0.6);',
	    		cssBody:'display: -webkit-box; -webkit-box-orient:vertical; -webkit-box-pack: center; -webkit-box-align:center; width: 100%; height: 100%;',
	    		cssImg:'max-width: 100%; max-height: 100%;'
	    	}
	    	var body=document.querySelector('body');
			function ImgShow(body1,css1){
				this.show1=function(){
					var imgBox=document.createElement("div");
		    		var imgBody=document.createElement("div");
		    		var newImg=document.createElement("img");
		    		imgBox.style.cssText=arguments[2].cssBox;
		    		imgBody.style.cssText=arguments[2].cssBody;
		    		newImg.style.cssText=arguments[2].cssImg;
		    		newImg.setAttribute('src',arguments[1].getAttribute('src'));
		    		imgBody.appendChild(newImg);
		    		imgBox.appendChild(imgBody);
		    		document.querySelector('body').appendChild(imgBox);
		    		imgBox.onclick=function(){
		    			this.style.display='none';
		    			this.remove();
		    		}
				}
				this.imgList=body1.getElementsByTagName('img');
				for(var i=0;i<this.imgList.length;i++){
					var _self=this;
					this.imgList[i].addEventListener('click',function(event){
						_self.show1(event,this,css1);
					},false);
				}
			}
			var zImg=new ImgShow(body,css);
    	</script>


</body></html>